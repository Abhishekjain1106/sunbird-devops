- include_vars: secrets/{{env}}.yml
  ignore_errors: true

- name: Install jq
  apt: name=jq state=present
  become: yes

- name: Create secrets
  shell: "echo '{{item.value}}' | docker secret create {{item.name}} -"
  with_items: "{{swarm_secrets}}"
  ignore_errors: true
  no_log: true
  run_once: true

- name: Create networks
  docker_network: name={{item}} driver=overlay
  with_items:
    - "{{networks}}"
  tags:
      - create_network
  run_once: true
