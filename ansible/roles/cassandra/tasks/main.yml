- name: Cassandra | Update the cassandra host configuration
  become: yes
  template: src=hosts.j2 dest=/etc/hosts


- name: debian | Adding Cassandra Debian Repo Key
  apt_key:
    url: "{{ cassandra_debian_repo_info.repo_key }}"
    state: "present"

- name: debian | Adding Cassandra Debian Repo
  apt_repository:
    repo: "{{ cassandra_debian_repo_info.repo }}"
    state: "present"

- name: debian | Installing Cassandra
  apt:
    name: "cassandra"
    state: "present"

- name: config | Configuring Cassandra
  template:
    src: "cassandra.yaml.j2"
    dest: "{{ cassandra_root_dir }}/cassandra.yaml"
    owner: "root"
    group: "root"
    mode: 0644
  notify: "restart cassandra"

- name: Copy the templates
  become: yes
  template: src={{item}} dest=/tmp/{{item}}
  with_items:
             - cassandra.cql
             - pageMgmt.csv
             - pageSection.csv

- name: Run the cassandra.cql command
  become: yes
  command: "cqlsh -f /tmp/cassandra.cql"
  ignore_errors: yes

- name: Run the pageMgmt.csv command
  become: yes
  command: cqlsh -e "COPY sunbird.page_management(id, appmap,createdby ,createddate ,name ,organisationid ,portalmap ,updatedby ,updateddate ) FROM '/tmp/pageMgmt.csv'" 

- name: Run the pageSection.csv file
  become: yes
  command: cqlsh -e "COPY sunbird.page_section(id, alt,createdby ,createddate ,description ,display ,imgurl ,name,searchquery , sectiondatatype ,status , updatedby ,updateddate) FROM '/tmp/cql/pageSection.csv'"